
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A proof-of-concept secure document management system with granular access control.">
      
      
      
        <link rel="canonical" href="https://subhayu99.github.io/DocumentAccessPOC/api/models/">
      
      
        <link rel="prev" href="../../extensibility/">
      
      
        <link rel="next" href="../logic/">
      
      
        
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.0">
    
    
      
        <title>Models - DocumentAccessPOC</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.618322db.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#models" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="DocumentAccessPOC" class="md-header__button md-logo" aria-label="DocumentAccessPOC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            DocumentAccessPOC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Models
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="teal" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/subhayu99/DocumentAccessPOC" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    subhayu99/DocumentAccessPOC
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../.." class="md-tabs__link">
          
  
  
  Home

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../solution/" class="md-tabs__link">
          
  
  
  Architecture

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
  
  API Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="DocumentAccessPOC" class="md-nav__button md-logo" aria-label="DocumentAccessPOC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    DocumentAccessPOC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/subhayu99/DocumentAccessPOC" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    subhayu99/DocumentAccessPOC
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    Home
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Intro
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quick-start/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Quick Start
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../usage/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Usage Examples
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../security/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Security Model
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../roadmap/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Roadmap
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    FAQ
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../features/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Key Features
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Architecture
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../solution/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Solution Overview
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../flow/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    API Flow
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../extensibility/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Extensibility
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    API Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Models
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modelsbase" class="md-nav__link">
    <span class="md-ellipsis">
      
        models.base
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models.base">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.base" class="md-nav__link">
    <span class="md-ellipsis">
      
        base
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelsdocument" class="md-nav__link">
    <span class="md-ellipsis">
      
        models.document
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models.document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.document" class="md-nav__link">
    <span class="md-ellipsis">
      
        document
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.document.Document" class="md-nav__link">
    <span class="md-ellipsis">
      
        Document
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.document.Document.get_dek" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dek
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.Document.update_shared_keys_registry" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_shared_keys_registry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.DocumentBase" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentBase
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.DocumentCommon" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentCommon
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.DocumentDownloadResponse" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentDownloadResponse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.DocumentShareResponse" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentShareResponse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.SharedKeyRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        SharedKeyRegistry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelsenums" class="md-nav__link">
    <span class="md-ellipsis">
      
        models.enums
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models.enums">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.enums" class="md-nav__link">
    <span class="md-ellipsis">
      
        enums
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelsuser" class="md-nav__link">
    <span class="md-ellipsis">
      
        models.user
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models.user">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.user" class="md-nav__link">
    <span class="md-ellipsis">
      
        user
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.user.User" class="md-nav__link">
    <span class="md-ellipsis">
      
        User
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.user.User.verify_private_key" class="md-nav__link">
    <span class="md-ellipsis">
      
        verify_private_key
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../logic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Logic
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../helpers/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Helpers
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../backends/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Backends
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../root/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Root
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#modelsbase" class="md-nav__link">
    <span class="md-ellipsis">
      
        models.base
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models.base">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.base" class="md-nav__link">
    <span class="md-ellipsis">
      
        base
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelsdocument" class="md-nav__link">
    <span class="md-ellipsis">
      
        models.document
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models.document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.document" class="md-nav__link">
    <span class="md-ellipsis">
      
        document
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.document.Document" class="md-nav__link">
    <span class="md-ellipsis">
      
        Document
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Document">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.document.Document.get_dek" class="md-nav__link">
    <span class="md-ellipsis">
      
        get_dek
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.Document.update_shared_keys_registry" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_shared_keys_registry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.DocumentBase" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentBase
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.DocumentCommon" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentCommon
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.DocumentDownloadResponse" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentDownloadResponse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.DocumentShareResponse" class="md-nav__link">
    <span class="md-ellipsis">
      
        DocumentShareResponse
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#models.document.SharedKeyRegistry" class="md-nav__link">
    <span class="md-ellipsis">
      
        SharedKeyRegistry
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelsenums" class="md-nav__link">
    <span class="md-ellipsis">
      
        models.enums
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models.enums">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.enums" class="md-nav__link">
    <span class="md-ellipsis">
      
        enums
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#modelsuser" class="md-nav__link">
    <span class="md-ellipsis">
      
        models.user
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="models.user">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.user" class="md-nav__link">
    <span class="md-ellipsis">
      
        user
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="user">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.user.User" class="md-nav__link">
    <span class="md-ellipsis">
      
        User
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="User">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#models.user.User.verify_private_key" class="md-nav__link">
    <span class="md-ellipsis">
      
        verify_private_key
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="models">Models</h1>
<h2 id="modelsbase">models.base</h2>


<div class="doc doc-object doc-module">



<h3 id="models.base" class="doc doc-heading">
            <code>models.base</code>


</h3>

    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div><hr />
<h2 id="modelsdocument">models.document</h2>


<div class="doc doc-object doc-module">



<h3 id="models.document" class="doc doc-heading">
            <code>models.document</code>


</h3>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="models.document.Document" class="doc doc-heading">
            <code>Document</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="models.base.SQLModelWithID">SQLModelWithID</span></code>, <code><a class="autorefs autorefs-internal" title="DocumentCommon (models.document.DocumentCommon)" href="#models.document.DocumentCommon">DocumentCommon</a></code></p>



        <p>A document is a file that can be accessed by the users of the system. Each
document has a unique ID, filepath, content, and owner. The owner is the
user who originally uploaded the document.</p>
<p>The document is stored in the file system, and the filepath is used to
identify the document. The content of the document is encrypted using the
Data Encryption Key (DEK) before it is stored in the file system.</p>
<p>Each document has a list of users who have access to the document. The
access is granted using the User ID of the users. The users with access
to the document can download the document.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="models.document.Document.id">id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unique identifier for the document.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.Document.filepath">filepath</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filepath of the document in the file system.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.Document.content">content</span></code></td>
            <td>
                  <code><span title="bytes">bytes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The content of the document in bytes.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.Document.owner_id">owner_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The User ID of the owner of the document.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.Document.shared_keys">shared_keys</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="SharedKeyRegistry (models.document.SharedKeyRegistry)" href="#models.document.SharedKeyRegistry">SharedKeyRegistry</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of SharedKeyRegistry
objects that store the shared encryption keys for the document.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.Document.uploaded_on">uploaded_on</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The timestamp when the document was uploaded.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>models/document.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="k">class</span><span class="w"> </span><span class="nc">Document</span><span class="p">(</span><span class="n">SQLModelWithID</span><span class="p">,</span> <span class="n">DocumentCommon</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">    A document is a file that can be accessed by the users of the system. Each</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">    document has a unique ID, filepath, content, and owner. The owner is the</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">    user who originally uploaded the document.</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="sd">    The document is stored in the file system, and the filepath is used to</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">    identify the document. The content of the document is encrypted using the</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">    Data Encryption Key (DEK) before it is stored in the file system.</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">    Each document has a list of users who have access to the document. The</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">    access is granted using the User ID of the users. The users with access</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">    to the document can download the document.</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">        id (str): Unique identifier for the document.</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        filepath (str): The filepath of the document in the file system.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">        content (bytes): The content of the document in bytes.</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">        owner_id (str): The User ID of the owner of the document.</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">        shared_keys (list[SharedKeyRegistry]): A list of SharedKeyRegistry</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">            objects that store the shared encryption keys for the document.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">        uploaded_on (datetime): The timestamp when the document was uploaded.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="nb">hash</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="n">uploaded_on</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="k">lambda</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="n">timezone</span><span class="o">.</span><span class="n">utc</span><span class="p">))</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">shared_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">SharedKeyRegistry</span><span class="p">]</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;document&quot;</span><span class="p">,</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="n">sa_relationship_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;primaryjoin&quot;</span><span class="p">:</span> <span class="s2">&quot;SharedKeyRegistry.document_id == Document.id&quot;</span><span class="p">},</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="n">cascade_delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>    <span class="p">)</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">local_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">.bin&quot;</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">write_content</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">DOCUMENT_STORE</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_path</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="k">return</span> <span class="n">DOCUMENT_STORE</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local_path</span><span class="p">)</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">update_shared_keys_registry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">dek</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        Updates the shared keys registry for the given users.</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        This function updates the SharedKeyRegistry table with the given user</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        IDs and the Data Encryption Key (DEK) for the document. The DEK is</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        encrypted using the public key of each user and stored in the</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        SharedKeyRegistry table.</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">            user_ids (list[str]): A list of User IDs to update the shared</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">                keys registry for.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">            dek (bytes): The Data Encryption Key (DEK) to store in the</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">                SharedKeyRegistry table. The DEK is encrypted using the</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">                public key of each user before it is stored.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="n">user_id_obj_map</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">get_id_obj_map</span><span class="p">(</span><span class="n">user_ids</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>        <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_id_obj_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>            <span class="n">shared_key</span> <span class="o">=</span> <span class="n">SharedKeyRegistry</span><span class="p">(</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>                <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>                <span class="n">document_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>                <span class="n">shared_key</span><span class="o">=</span><span class="n">RSA</span><span class="o">.</span><span class="n">encrypt_data</span><span class="p">(</span><span class="n">dek</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">public_key</span><span class="p">),</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>            <span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>            <span class="n">shared_key</span><span class="o">.</span><span class="n">upsert</span><span class="p">()</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_dek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_private_key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        Get the DEK for the given user_id, using the private key provided.</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">        Args:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">            user_id (str): The ID of the user.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">            user_private_key (bytes): The user&#39;s private key.</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">        Returns:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">            bytes: The DEK for the document.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        Raises:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">            ValueError: If the document is not shared with the user or if the</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">                private key is invalid.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        &quot;&quot;&quot;</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">getEngine</span><span class="p">())</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>            <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>                <span class="n">select</span><span class="p">(</span><span class="n">SharedKeyRegistry</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                    <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">document_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                    <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>                <span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>            <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Document(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">) not shared with User(</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>            <span class="k">return</span> <span class="n">RSA</span><span class="o">.</span><span class="n">decrypt_data</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shared_key</span><span class="p">,</span> <span class="n">user_private_key</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid private key for User(</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_base</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">DocumentBase</span><span class="p">):</span>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">upload</span><span class="p">(</span><span class="n">document</span><span class="p">)</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_to_share_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>        <span class="k">return</span> <span class="n">DocumentShareResponse</span><span class="p">(</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a>            <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a>            <span class="n">filepath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>            <span class="n">owner_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">owner_id</span><span class="p">,</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>            <span class="n">uploaded_on</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">uploaded_on</span><span class="p">,</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>            <span class="n">shared_with</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shared_with</span><span class="p">,</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>            <span class="n">not_shared_with</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">user_ids</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shared_with</span><span class="p">)),</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>        <span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">upload</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">document</span><span class="p">:</span> <span class="n">DocumentBase</span><span class="p">):</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>        <span class="n">owner_id</span> <span class="o">=</span> <span class="n">document</span><span class="o">.</span><span class="n">owner_id</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>        <span class="k">if</span> <span class="n">User</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="n">owner_id</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;User (</span><span class="si">{</span><span class="n">owner_id</span><span class="si">}</span><span class="s2">) not found&quot;</span><span class="p">)</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">file_hash</span> <span class="o">=</span> <span class="n">hash_file</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>        <span class="n">doc_id</span> <span class="o">=</span> <span class="n">hash_text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">owner_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">document</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">file_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="c1"># Check if document already exists (maybe use hash and/or filepath)</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>        <span class="n">record</span> <span class="o">=</span> <span class="n">Document</span><span class="o">.</span><span class="n">get_by_id</span><span class="p">(</span><span class="n">doc_id</span><span class="p">)</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="k">if</span> <span class="n">record</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>            <span class="k">return</span> <span class="n">record</span><span class="o">.</span><span class="n">_to_share_response</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">share_with</span><span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">dek</span> <span class="o">=</span> <span class="n">AES</span><span class="o">.</span><span class="n">get_random_key</span><span class="p">()</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">encrypted_content</span> <span class="o">=</span> <span class="n">AES</span><span class="p">(</span><span class="n">dek</span><span class="p">)</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="n">doc</span> <span class="o">=</span> <span class="n">Document</span><span class="p">(</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>            <span class="nb">id</span><span class="o">=</span><span class="n">hash_text</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">owner_id</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">document</span><span class="o">.</span><span class="n">filepath</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">file_hash</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">hex</span><span class="p">,</span>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>            <span class="n">filepath</span><span class="o">=</span><span class="n">document</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>            <span class="n">owner_id</span><span class="o">=</span><span class="n">owner_id</span><span class="p">,</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>            <span class="nb">hash</span><span class="o">=</span><span class="n">file_hash</span><span class="p">,</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>        <span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>        <span class="n">doc</span><span class="o">.</span><span class="n">update_shared_keys_registry</span><span class="p">([</span><span class="n">owner_id</span><span class="p">,</span> <span class="o">*</span><span class="n">document</span><span class="o">.</span><span class="n">share_with</span><span class="p">],</span> <span class="n">dek</span><span class="p">)</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="n">doc</span><span class="o">.</span><span class="n">write_content</span><span class="p">(</span><span class="n">encrypted_content</span><span class="p">)</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="k">return</span> <span class="n">doc</span><span class="o">.</span><span class="n">_to_share_response</span><span class="p">(</span><span class="n">document</span><span class="o">.</span><span class="n">share_with</span><span class="p">)</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">share</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">owner_private_key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DocumentShareResponse</span><span class="p">:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>        <span class="n">dek</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">owner_id</span><span class="p">,</span> <span class="n">owner_private_key</span><span class="p">)</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">update_shared_keys_registry</span><span class="p">(</span><span class="n">user_ids</span><span class="p">,</span> <span class="n">dek</span><span class="p">)</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_share_response</span><span class="p">(</span><span class="n">user_ids</span><span class="p">)</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">revoke_access</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">owner_private_key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DocumentShareResponse</span><span class="p">:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>        <span class="c1"># This checks if the user is the owner</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="n">dek</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">owner_id</span><span class="p">,</span> <span class="n">owner_private_key</span><span class="p">)</span>  <span class="c1"># noqa: F841</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">owner_id</span> <span class="ow">in</span> <span class="n">user_ids</span><span class="p">:</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot revoke access to the owner&quot;</span><span class="p">)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">getEngine</span><span class="p">())</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>            <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>                <span class="n">select</span><span class="p">(</span><span class="n">SharedKeyRegistry</span><span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>                    <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">document_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>                    <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">user_id</span><span class="o">.</span><span class="n">in_</span><span class="p">(</span><span class="n">user_ids</span><span class="p">),</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>                <span class="p">)</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>            <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>            <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_to_share_response</span><span class="p">(</span><span class="n">user_ids</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_private_key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>        <span class="n">dek</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dek</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">user_private_key</span><span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>        <span class="n">content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_content</span><span class="p">()</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="k">return</span> <span class="n">DocumentDownloadResponse</span><span class="p">(</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>            <span class="n">filepath</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">,</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>            <span class="n">content</span><span class="o">=</span><span class="n">AES</span><span class="p">(</span><span class="n">dek</span><span class="p">)</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">content</span><span class="p">),</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>            <span class="n">owner_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">owner_id</span><span class="p">,</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>        <span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="c1"># Delete the document from the document store</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="n">DOCUMENT_STORE</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filepath</span><span class="p">)</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>        <span class="c1"># Delete the shared keys</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">getEngine</span><span class="p">())</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>            <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>                <span class="n">select</span><span class="p">(</span><span class="n">SharedKeyRegistry</span><span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>                    <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">document_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>                <span class="p">)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>            <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>            <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">:</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>                <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="c1"># Delete the document itself</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">delete</span><span class="p">()</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>    <span class="nd">@property</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">shared_with</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">getEngine</span><span class="p">())</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>                <span class="n">select</span><span class="p">(</span><span class="n">SharedKeyRegistry</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>                    <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">document_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>                <span class="p">)</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>            <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="k">return</span> <span class="p">[</span><span class="n">row</span><span class="o">.</span><span class="n">user_id</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_shared_documents</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>        <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">getEngine</span><span class="p">())</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>            <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>                <span class="n">select</span><span class="p">(</span><span class="n">SharedKeyRegistry</span><span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>                <span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>                    <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>                <span class="p">)</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>            <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">get_by_ids</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">document_id</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">rows</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="models.document.Document.get_dek" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_dek</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">user_private_key</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Get the DEK for the given user_id, using the private key provided.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_id</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The ID of the user.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>user_private_key</code>
            </td>
            <td>
                  <code><span title="bytes">bytes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user's private key.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>bytes</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The DEK for the document.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Raises:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="ValueError">ValueError</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If the document is not shared with the user or if the
private key is invalid.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>models/document.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="k">def</span><span class="w"> </span><span class="nf">get_dek</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">user_private_key</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">    Get the DEK for the given user_id, using the private key provided.</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="sd">        user_id (str): The ID of the user.</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">        user_private_key (bytes): The user&#39;s private key.</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">        bytes: The DEK for the document.</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">    Raises:</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        ValueError: If the document is not shared with the user or if the</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">            private key is invalid.</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="k">with</span> <span class="n">Session</span><span class="p">(</span><span class="n">getEngine</span><span class="p">())</span> <span class="k">as</span> <span class="n">db</span><span class="p">:</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>        <span class="n">rows</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">exec</span><span class="p">(</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>            <span class="n">select</span><span class="p">(</span><span class="n">SharedKeyRegistry</span><span class="p">)</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>            <span class="o">.</span><span class="n">where</span><span class="p">(</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>                <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">document_id</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>                <span class="n">SharedKeyRegistry</span><span class="o">.</span><span class="n">user_id</span> <span class="o">==</span> <span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>            <span class="p">)</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">rows</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Document(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">) not shared with User(</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>        <span class="k">return</span> <span class="n">RSA</span><span class="o">.</span><span class="n">decrypt_data</span><span class="p">(</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shared_key</span><span class="p">,</span> <span class="n">user_private_key</span><span class="p">)</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Invalid private key for User(</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="models.document.Document.update_shared_keys_registry" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_shared_keys_registry</span><span class="p">(</span><span class="n">user_ids</span><span class="p">,</span> <span class="n">dek</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Updates the shared keys registry for the given users.</p>
<p>This function updates the SharedKeyRegistry table with the given user
IDs and the Data Encryption Key (DEK) for the document. The DEK is
encrypted using the public key of each user and stored in the
SharedKeyRegistry table.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>user_ids</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of User IDs to update the shared
keys registry for.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dek</code>
            </td>
            <td>
                  <code><span title="bytes">bytes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Data Encryption Key (DEK) to store in the
SharedKeyRegistry table. The DEK is encrypted using the
public key of each user before it is stored.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>models/document.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="k">def</span><span class="w"> </span><span class="nf">update_shared_keys_registry</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">dek</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">    Updates the shared keys registry for the given users.</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">    This function updates the SharedKeyRegistry table with the given user</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    IDs and the Data Encryption Key (DEK) for the document. The DEK is</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    encrypted using the public key of each user and stored in the</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">    SharedKeyRegistry table.</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        user_ids (list[str]): A list of User IDs to update the shared</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">            keys registry for.</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        dek (bytes): The Data Encryption Key (DEK) to store in the</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">            SharedKeyRegistry table. The DEK is encrypted using the</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">            public key of each user before it is stored.</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="n">user_id_obj_map</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">get_id_obj_map</span><span class="p">(</span><span class="n">user_ids</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">user_id_obj_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>        <span class="n">shared_key</span> <span class="o">=</span> <span class="n">SharedKeyRegistry</span><span class="p">(</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>            <span class="n">user_id</span><span class="o">=</span><span class="n">user_id</span><span class="p">,</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>            <span class="n">document_id</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">),</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>            <span class="n">shared_key</span><span class="o">=</span><span class="n">RSA</span><span class="o">.</span><span class="n">encrypt_data</span><span class="p">(</span><span class="n">dek</span><span class="p">,</span> <span class="n">user</span><span class="o">.</span><span class="n">public_key</span><span class="p">),</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>        <span class="n">shared_key</span><span class="o">.</span><span class="n">upsert</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="models.document.DocumentBase" class="doc doc-heading">
            <code>DocumentBase</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="DocumentDownloadResponse (models.document.DocumentDownloadResponse)" href="#models.document.DocumentDownloadResponse">DocumentDownloadResponse</a></code></p>



        <p>Base model for creating new documents.</p>
<p>This model is used to create new documents in the system. It contains the
essential information required to create a document, such as the filepath
and content of the document.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>models/document.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-89">89</a></span>
<span class="normal"><a href="#__codelineno-0-90">90</a></span>
<span class="normal"><a href="#__codelineno-0-91">91</a></span>
<span class="normal"><a href="#__codelineno-0-92">92</a></span>
<span class="normal"><a href="#__codelineno-0-93">93</a></span>
<span class="normal"><a href="#__codelineno-0-94">94</a></span>
<span class="normal"><a href="#__codelineno-0-95">95</a></span>
<span class="normal"><a href="#__codelineno-0-96">96</a></span>
<span class="normal"><a href="#__codelineno-0-97">97</a></span>
<span class="normal"><a href="#__codelineno-0-98">98</a></span>
<span class="normal"><a href="#__codelineno-0-99">99</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="k">class</span><span class="w"> </span><span class="nc">DocumentBase</span><span class="p">(</span><span class="n">DocumentDownloadResponse</span><span class="p">):</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">    Base model for creating new documents.</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    This model is used to create new documents in the system. It contains the</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">    essential information required to create a document, such as the filepath</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">    and content of the document.</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">share_with</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>        <span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User IDs to give access to this document.&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="models.document.DocumentCommon" class="doc doc-heading">
            <code>DocumentCommon</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="models.base.SQLModel">SQLModel</span></code></p>



        <p>Common fields for Document and DocumentBase models.</p>
<p>This class serves as a base for storing common attributes related to documents. 
It provides a standardized way to define the essential properties required for 
handling documents within the system. The attributes defined here are shared 
among different document models to ensure consistency.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="models.document.DocumentCommon.filepath">filepath</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filepath of the document. This is used to locate the 
document in the storage system. The path is indexed to improve the 
performance of queries that filter or sort based on the document's path.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.DocumentCommon.owner_id">owner_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The User ID of the owner of the document. This field 
establishes an ownership link between the document and a user in the 
system. It uses a foreign key reference to ensure that the owner_id 
corresponds to a valid user in the database.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>models/document.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="k">class</span><span class="w"> </span><span class="nc">DocumentCommon</span><span class="p">(</span><span class="n">SQLModel</span><span class="p">):</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">    Common fields for Document and DocumentBase models.</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">    This class serves as a base for storing common attributes related to documents. </span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">    It provides a standardized way to define the essential properties required for </span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a><span class="sd">    handling documents within the system. The attributes defined here are shared </span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    among different document models to ensure consistency.</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        filepath (str): The filepath of the document. This is used to locate the </span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">            document in the storage system. The path is indexed to improve the </span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">            performance of queries that filter or sort based on the document&#39;s path.</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a><span class="sd">        owner_id (str): The User ID of the owner of the document. This field </span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a><span class="sd">            establishes an ownership link between the document and a user in the </span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a><span class="sd">            system. It uses a foreign key reference to ensure that the owner_id </span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a><span class="sd">            corresponds to a valid user in the database.</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The filepath of the document&quot;</span><span class="p">)</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">owner_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">foreign_key</span><span class="o">=</span><span class="s2">&quot;user.id&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;User ID of the Owner of the document&quot;</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="models.document.DocumentDownloadResponse" class="doc doc-heading">
            <code>DocumentDownloadResponse</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="DocumentCommon (models.document.DocumentCommon)" href="#models.document.DocumentCommon">DocumentCommon</a></code></p>



        <p>Document download response model.</p>
<p>This model is used to represent a document that is being downloaded from the
server. It contains the filepath and content of the document.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>models/document.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-67">67</a></span>
<span class="normal"><a href="#__codelineno-0-68">68</a></span>
<span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-67" name="__codelineno-0-67"></a><span class="k">class</span><span class="w"> </span><span class="nc">DocumentDownloadResponse</span><span class="p">(</span><span class="n">DocumentCommon</span><span class="p">):</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="sd">    Document download response model.</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    This model is used to represent a document that is being downloaded from the</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    server. It contains the filepath and content of the document.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="n">content</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">description</span><span class="o">=</span><span class="s2">&quot;The content of the document in bytes&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="models.document.DocumentShareResponse" class="doc doc-heading">
            <code>DocumentShareResponse</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="DocumentCommon (models.document.DocumentCommon)" href="#models.document.DocumentCommon">DocumentCommon</a></code></p>



        <p>Document share response model.</p>
<p>This model is used to represent a document that is being shared with another
user.</p>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>models/document.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span>
<span class="normal"><a href="#__codelineno-0-82">82</a></span>
<span class="normal"><a href="#__codelineno-0-83">83</a></span>
<span class="normal"><a href="#__codelineno-0-84">84</a></span>
<span class="normal"><a href="#__codelineno-0-85">85</a></span>
<span class="normal"><a href="#__codelineno-0-86">86</a></span>
<span class="normal"><a href="#__codelineno-0-87">87</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="k">class</span><span class="w"> </span><span class="nc">DocumentShareResponse</span><span class="p">(</span><span class="n">DocumentCommon</span><span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Document share response model.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    This model is used to represent a document that is being shared with another</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    user.</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>    <span class="n">owner_id</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>    <span class="n">uploaded_on</span><span class="p">:</span> <span class="n">datetime</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="n">shared_with</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>    <span class="n">not_shared_with</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="nb">list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="models.document.SharedKeyRegistry" class="doc doc-heading">
            <code>SharedKeyRegistry</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="models.base.SQLModel">SQLModel</span></code></p>



        <p>Stores the shared encryption keys for a given document and user pair.</p>
<p>The shared key is encrypted using the user's public key, and can be decrypted
by the user using their private key. This allows the user to access the document
without having to be re-shared the document.</p>
<p>The shared key is stored in the database as a binary blob, and is encrypted
using the user's public key. This means that only the user who the document is
shared with can decrypt the shared key.</p>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="models.document.SharedKeyRegistry.user_id">user_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The User ID of the user the document is shared with.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.SharedKeyRegistry.document_id">document_id</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The Document ID of the document that is shared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.SharedKeyRegistry.shared_key">shared_key</span></code></td>
            <td>
                  <code><span title="bytes">bytes</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The encrypted shared key.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.SharedKeyRegistry.created_at">created_at</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The timestamp when the shared key was created.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.SharedKeyRegistry.document">document</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Document (models.document.Document)" href="#models.document.Document">Document</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The document that is shared.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="models.document.SharedKeyRegistry.user">user</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="User (models.user.User)" href="#models.user.User">User</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The user that the document is shared with.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>models/document.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-14">14</a></span>
<span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-14" name="__codelineno-0-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">SharedKeyRegistry</span><span class="p">(</span><span class="n">SQLModel</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a><span class="sd">    Stores the shared encryption keys for a given document and user pair.</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a><span class="sd">    The shared key is encrypted using the user&#39;s public key, and can be decrypted</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="sd">    by the user using their private key. This allows the user to access the document</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a><span class="sd">    without having to be re-shared the document.</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="sd">    The shared key is stored in the database as a binary blob, and is encrypted</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="sd">    using the user&#39;s public key. This means that only the user who the document is</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a><span class="sd">    shared with can decrypt the shared key.</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a><span class="sd">    Attributes:</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">        user_id (str): The User ID of the user the document is shared with.</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="sd">        document_id (str): The Document ID of the document that is shared.</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">        shared_key (bytes): The encrypted shared key.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        created_at (datetime): The timestamp when the shared key was created.</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">        document (Document): The document that is shared.</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        user (User): The user that the document is shared with.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">foreign_key</span><span class="o">=</span><span class="s2">&quot;user.id&quot;</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">)</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>    <span class="n">document_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">foreign_key</span><span class="o">=</span><span class="s2">&quot;document.id&quot;</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ondelete</span><span class="o">=</span><span class="s2">&quot;CASCADE&quot;</span><span class="p">)</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>    <span class="n">shared_key</span><span class="p">:</span> <span class="nb">bytes</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>    <span class="n">document</span><span class="p">:</span> <span class="s2">&quot;Document&quot;</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;shared_keys&quot;</span><span class="p">)</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>    <span class="n">user</span><span class="p">:</span> <span class="s2">&quot;User&quot;</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;shared_keys&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">












  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />
<h2 id="modelsenums">models.enums</h2>


<div class="doc doc-object doc-module">



<h3 id="models.enums" class="doc doc-heading">
            <code>models.enums</code>


</h3>

    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div><hr />
<h2 id="modelsuser">models.user</h2>


<div class="doc doc-object doc-module">



<h3 id="models.user" class="doc doc-heading">
            <code>models.user</code>


</h3>

    <div class="doc doc-contents first">










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h4 id="models.user.User" class="doc doc-heading">
            <code>User</code>


</h4>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="models.user.UserBase">UserBase</span></code></p>










              <details class="mkdocstrings-source">
                <summary>Source code in <code>models/user.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-60" name="__codelineno-0-60"></a><span class="k">class</span><span class="w"> </span><span class="nc">User</span><span class="p">(</span><span class="n">UserBase</span><span class="p">,</span> <span class="n">table</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">public_key</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">encrypted_private_key</span><span class="p">:</span> <span class="nb">str</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">created_at</span><span class="p">:</span> <span class="n">datetime</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="n">default_factory</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="c1"># Many-to-many relationships via intermediary tables</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">teams</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Team</span><span class="p">]</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span><span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;members&quot;</span><span class="p">,</span> <span class="n">link_model</span><span class="o">=</span><span class="n">UserTeamLink</span><span class="p">)</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">projects</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Project</span><span class="p">]</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;members&quot;</span><span class="p">,</span> <span class="n">link_model</span><span class="o">=</span><span class="n">UserProjectLink</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="p">)</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="n">shared_keys</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="s2">&quot;SharedKeyRegistry&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Relationship</span><span class="p">(</span>  <span class="c1"># noqa: F821</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>        <span class="n">back_populates</span><span class="o">=</span><span class="s2">&quot;user&quot;</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>        <span class="n">sa_relationship_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;primaryjoin&quot;</span><span class="p">:</span> <span class="s2">&quot;SharedKeyRegistry.user_id == User.id&quot;</span><span class="p">},</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>        <span class="n">cascade_delete</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">from_base</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">user</span><span class="p">:</span> <span class="n">UserBase</span><span class="p">):</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>        <span class="n">private_key</span><span class="p">,</span> <span class="n">public_key</span> <span class="o">=</span> <span class="n">RSA</span><span class="o">.</span><span class="n">generate_key_pair</span><span class="p">(</span><span class="n">out_format</span><span class="o">=</span><span class="n">KeyFormat</span><span class="o">.</span><span class="n">STRING</span><span class="p">)</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>        <span class="n">parmanent_password</span> <span class="o">=</span> <span class="n">generate_phrase</span><span class="p">(</span><span class="n">length</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">capitalize</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">passphrase</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>        <span class="n">encrypted_private_key</span> <span class="o">=</span> <span class="n">AES</span><span class="p">(</span><span class="n">parmanent_password</span><span class="p">)</span><span class="o">.</span><span class="n">encrypt</span><span class="p">(</span><span class="n">private_key</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>        <span class="n">user_obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a>            <span class="nb">id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a>            <span class="n">name</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>            <span class="n">email</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>            <span class="n">designation</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="n">designation</span><span class="p">,</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>            <span class="n">public_key</span><span class="o">=</span><span class="n">public_key</span><span class="p">,</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a>            <span class="n">encrypted_private_key</span><span class="o">=</span><span class="n">encrypted_private_key</span><span class="o">.</span><span class="n">hex</span><span class="p">(),</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">return</span> <span class="n">UserCreateResponse</span><span class="p">(</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="nb">id</span><span class="o">=</span><span class="n">user_obj</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>            <span class="n">name</span><span class="o">=</span><span class="n">user_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>            <span class="n">email</span><span class="o">=</span><span class="n">user_obj</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>            <span class="n">designation</span><span class="o">=</span><span class="n">user_obj</span><span class="o">.</span><span class="n">designation</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>            <span class="n">parmanent_password</span><span class="o">=</span><span class="n">parmanent_password</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>        <span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="nd">@classmethod</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_id_obj_map</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">user_ids</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">users</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">get_by_ids</span><span class="p">(</span><span class="n">user_ids</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="k">return</span> <span class="p">{</span><span class="n">user</span><span class="o">.</span><span class="n">id</span><span class="p">:</span> <span class="n">user</span> <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">users</span><span class="p">}</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">get_private_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">return</span> <span class="n">AES</span><span class="p">(</span><span class="n">password</span><span class="p">)</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="nb">bytes</span><span class="o">.</span><span class="n">fromhex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">encrypted_private_key</span><span class="p">))</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_private_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Verifies that the given private key matches the public key of the user. Returns True if the key is valid, False otherwise.&quot;&quot;&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="k">return</span> <span class="n">RSA</span><span class="o">.</span><span class="n">verify_key_pair</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_private_key</span><span class="p">(</span><span class="n">password</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span><span class="p">)</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">verify_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">verify_private_key</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h5 id="models.user.User.verify_private_key" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">verify_private_key</span><span class="p">(</span><span class="n">password</span><span class="p">)</span></code>

</h5>


    <div class="doc doc-contents ">

        <p>Verifies that the given private key matches the public key of the user. Returns True if the key is valid, False otherwise.</p>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>models/user.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="k">def</span><span class="w"> </span><span class="nf">verify_private_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Verifies that the given private key matches the public key of the user. Returns True if the key is valid, False otherwise.&quot;&quot;&quot;</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>    <span class="k">return</span> <span class="n">RSA</span><span class="o">.</span><span class="n">verify_key_pair</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_private_key</span><span class="p">(</span><span class="n">password</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">public_key</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div><hr />












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.top", "content.code.copy", "toc.follow"], "search": "../../assets/javascripts/workers/search.7a47a382.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.e71a0d61.min.js"></script>
      
    
  </body>
</html>